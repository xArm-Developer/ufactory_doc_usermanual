# 3. Control

### 3.1 Use xArm Studio to Control BIO Gripper

1. **Set up BIO Gripper**
   - Enter [Settings]-[Motion]-[TCP]
   - Select the end effector: xArm BIO Gripper

![img_5.png](img_5.png)

2. **Control BIO Gripper**
   - Control the BIO gripper in the live control
Control Method:
1) Click the [Enable] button to enable the BIO gripper;
2) By clicking the [Open]/[Close] button, you can control the opening and closing of the gripper.
 

![img_6.png](img_6.png)

 - Control the BIO gripper through Blockly

Enter in the Blockly module and run the [UF]-1009_Bio_Gripper example in the UF_APPS directory

![img_7.png](img_7.png)

### 3.2 Use Python-SDK to Control BIO Gripper

For details on controlling Gripper with Python-SDK, please refer to the link below:

[Python-SDK Example](https://github.com/xArm-Developer/xArm-Python-SDK/blob/master/example/wrapper/common/5009-set_bio_gripper.py)

### 3.3 Use Modbus-TCP Communication Protocol to Control BIO Gripper

![img_8.png](img_8.png)


This section mainly explains how to control the BIO Gripper by using the Modbus-TCP protocol through xArm control box.

#### 3.3.1 Modbus-TCP Communication Format

**Modbus-TCP:**

Modbus protocol is an application layer message transmission protocol, including three message types: ASCII, RTU, and TCP. The standard Modbus protocol physical layer interface includes RS232, RS422, RS485 and Ethernet interfaces, and adopts master / slave communication.

**Modbus TCP Communication Process:**

1. Establish a TCP connection
2. Prepare Modbus messages
3. Use the send command to send a message
4. Wait for a response under the same connection
5. Use the recv command to read the message and complete a data exchange
6. When the communication task ends, close the TCP connection

**Parameter:**

- Default TCP Port: 502
- Protocol: 0x00 0x02

On the problem of users using communication protocols to organize data in big endian and little endian:

In this article, data analysis is big-endian analysis.

#### 3.3.2 Read BIO Gripper Register

**Register Function**

| **Read Register** |                           |                 |             |
| ----------------- | ------------------------- |-----------------|-------------|
| **Request**       |                           |                 |             |
| MBTP Header       | Transaction Identifier    | 2 Bytes         | 0x0001      |
|                   | Protocol Identifier       | 2 Bytes         | 0x0002      |
|                   | Length                    | 2 Bytes         | **6+N\*x2** |
|                   | Unit Identifier           | 1 Byte          | 0x7C        |
| Internal Use      | Internal Use              | 1 Byte          | 0x09        |
| Modbus RTU Data   | Slave ID (Gripper)        | 1 Byte          | 0x08        |
|                   | Function Code             | 1 Byte          | 0x03        |
|                   | Register Starting Address | 2 Bytes         | **Address** |
|                   | Quantity of Registers     | **N\*x2** Bytes | **N\***     |
| **Response**      |                           |                 |             |
| MBTP Header       | Transaction Identifier    | 2 Bytes         | 0x0001      |
|                   | Protocol Identifier       | 2 Bytes         | 0x0002      |
|                   | Length                    | 2 Bytes         | **6+N\*x2** |
|                   | Unit Identifier           | 1 Byte          | 0x7C        |
|                   | Status Value              | 1 Byte          | 0x00        |
| Internal Use      | Internal Use              | 1 Byte          | 0x09        |
| Modbus RTU Data   | Slave ID                  | 1 Byte          | 0x08        |
|                   | Function Code             | 1 Byte          | 0x03        |
|                   | Byte Count                | 1 Byte          | **N\*x2**   |
|                   | Registers Value           | **N\*x2** Bytes | **Value**   |

N* = Quantity of Registers			
Address = Register Starting Address


#### 3.3.3 Write BIO Gripper Register

**Register Function**


|                             | **Resgister Starting Address** | **Registers Value** |                                                                                                                                                                                            |
| --------------------------- | ------------------------------ | ------------------- |--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Get Gripper status Register | 0x0000                         | 2 Bytes             | **Disabled\:** 0x0000   **Enabling:** 0x0004 **Enabling completed:** 0x0008  **Stop status**: 0x0008  **Motion status:** 0x0009   **Clipping status:** 0x000A  **Error status:** 0x000B |
| Get Gripper Error Register  | 0x000F                         | 2 Bytes             | **An error occurs:** all other return values indicate an error(except 0)**No error occurred:** 0x0000                                                                                      |


#### 3.3.4 BIO Gripper Control Process

The complete process of controlling the motion of the BIO Gripper is as follows:

1. Enable the Gripper
0x00, 0x01, 0x00, 0x02, 0x00, 0x0B, 0x7C, 0x09, 0x08, 0x10, 0x01, 0x00, 0x00, 0x01, 0x02, 0x00, 0x01

2. Open the Gripper

0x00, 0x01, 0x00, 0x02, 0x00, 0x0D, 0x7C, 0x09, 0x08, 0x10, 0x07, 0x00, 0x00, 0x02, 0x04, 0x00, 0x00, 0x00, 0x82

3. Close the Gripper

0x00, 0x01, 0x00, 0x02, 0x00, 0x0D, 0x7C, 0x09, 0x08, 0x10, 0x07, 0x00, 0x00, 0x02, 0x04, 0x00, 0x00, 0x00, 0x32

### 3.4 Use Modbus-RTU Communication Protocol to Control BIO Gripper

#### 3.4.1 Modbus RTU Communication Format

![img_9.png](img_9.png)


The gripper defaults to the standard Modbus RTU protocol at a default baud rate is 2Mbps and the slave ID is 0x08. The currently supported function codes are: 0x03 / 0x10. In this article, data analysis is big-endian analysis.

#### 3.4.2 Read BIO Gripper Register

**Register Function**

|  |      **Read Register**                     |                 |                 |
| ----------------- | ------------------------- | --------------- | --------------- |
| **Request**       |                           |                 |                 |
| Modbus RTU Data   | Slave ID (Gripper)        | 1 Byte          | 0x08            |
|                   | Function Code             | 1 Byte          | 0x03            |
|                   | Register Starting Address | 2 Bytes         | **Address**     |
|                   | Quantity of Register      | 2 Bytes         | **N\***         |
|                   | Modbus CRC16              | 2 Bytes         | ***\*CRC\*\**** |
| **Response**      |                           |                 |                 |
| Modbus RTU Data   | Slave ID                  | 1 Byte          | 0x08            |
|                   | Function Code             | 1 Byte          | 0x03            |
|                   | Byte Count                | 1 Byte          | **N\*x2**       |
|                   | Registers Value           | **N\***x2 Bytes | **Value**       |
|                   | Modbus CRC16              | 2 Bytes         | ***\*CRC\*\**** |

N* = Quantity of Registers			
Address = Register Starting Address
CRC* = Cyclic Redundancy Check 

**Resgister**

|                             | **Resgister Starting Address** | **Register Value** |                                                                                                                                                                                                |
| --------------------------- | ------------------------------ | ------------------ |------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Get Gripper status Register | 0x0000                         | 2 Bytes            | **Disabled:** 0x0000    **Enabling:** 0x0004 **Enabling completed:** 0x0008  **Stop status**: 0x0008    ***Motion status:** 0x0009   **Clipping status:** 0x000A   **Error status:** 0x000B |
| Get Gripper Error Register  | 0x000F                         | 2 Bytes            | **An error occurs:** all other return values indicate an error(except 0)**No error occurred:** 0x0000                                                                                          |

#### 3.4.3 Write BIO Gripper Register

**Register Function**

|  |          **Write Register**                 |                 |           |
| ------------------ | ------------------------- |-----------------|-----------|
| **Request**        |                           |                 |           |
| Modbus RTU Data    | Slave ID (Gripper)        | 1 Byte          | 0x08      |
|                    | Function Code             | 1 Byte          | 0x10      |
|                    | Register Starting Address | 2 Bytes         | **Address** |
|                    | Quantity of Register      | 2 Bytes         | **N\***   |
|                    | Byte Count                | 1 Byte          | **N\*x2** |
|                    | Registers Value           | **N\*x2** Bytes | **Value** |
|                    | Modbus CRC16              | 2 Bytes         | **CRC\*** |
| **Response**       |                           |                 |           |
| Modbus RTU Data    | Slave ID                  | 1 Byte          | 0x08      |
|                    | Function Code             | 1 Byte          | 0x10      |
|                    | Register Starting Address | 2 Bytes         | **Address** |
|                    | Quantity of Registers     | 2 Bytes         | **N\***   |
|                    | Modbus CRC16              | 2 Bytes         | **CRC\*** |

N* = Quantity of Registers			
Address = Register Starting Address
CRC* = Cyclic Redundancy Check 

**Resgister:**

|                                 | **Resgister Starting Address** | **Register Value** |                                                                               |
| ------------------------------- | ------------------------------ | ------------------ |-------------------------------------------------------------------------------|
| Enable/Disable Gripper Register | 0x0100                         | 2 Bytes            | **Enable :** 0x0001  **Disable :** 0x0000                                     |
| Set Gripper Position Register   | 0x0700                         | 4 Bytes            | **Open the Gripper :** 0x0000 0x0082    **Close the Gripper :** 0x0000 0x0032 |
| Set Position Speed Register     | 0x0303                         | 2 Bytes            | 0x0100-0x0400    **Unit :** r/min                                             |
| Clear Position Error Register   | 0x000F                         | 2 Bytes            | 0x0000                                                                        |




#### 3.4.4 Modbus RTU Example

This section demonstrates the example given in the Control Logic section when programmed using the Modbus RTU protocol.


Step1：Enable BIO Gripper


|  |     **Enable BIO Gripper**                      |         |        |
| ---------------------- | ------------------------- | ------- | ------ |
| **Request**            |                           |         |        |
| Modbus RTU Data        | Slave ID (Gripper)        | 1 Byte  | 0x08   |
|                        | Function Code             | 1 Byte  | 0x10   |
|                        | Register Starting Address | 2 Bytes | 0x0100 |
|                        | Quantity of Registers     | 2 Bytes | 0x0001 |
|                        | Byte Count                | 1 Byte  | 0x02   |
|                        | Registers Value           | 2 Bytes | 0x0001 |
|                        | Modbus CRC16              | 2 Bytes | 0x1D00 |
| **Response**           |                           |         |        |
| Modbus RTU Data        | Slave ID                  | 1 Byte  | 0x08   |
|                        | Function Code             | 1 Byte  | 0x10   |
|                        | Register Starting Address | 2 Bytes | 0x0100 |
|                        | Quantity of Registers     | 2 Bytes | 0x0001 |
|                        | Modbus CRC16              | 2 Bytes | 0x00AC |

Step2：Set BIO Gripper Speed

|  |              **Set BIO Gripper Speed**              |         |        |
| ------------------------- | -------------------------- | ------- | ------ |
| **Request**               |                            |         |        |
| Modbus RTU Data           | Slave ID (Gripper)         | 1 Byte  | 0x08   |
|                           | Function Code              | 1 Byte  | 0x10   |
|                           | Register Starting Address  | 2 Bytes | 0x0303 |
|                           | Quantity of Registers      | 2 Bytes | 0x0001 |
|                           | Byte Count                 | 1 Byte  | 0x02   |
|                           | Registers Value(1500r/min) | 2 Bytes | 0x05DC |
|                           | Modbus CRC16               | 2 Bytes | 0xFDFA |
| **Response**              |                            |         |        |
| Modbus RTU Data           | Slave ID                   | 1 Byte  | 0x08   |
|                           | Function Code              | 1 Byte  | 0x10   |
|                           | Register Starting Address  | 2 Bytes | 0x0303 |
|                           | Quantity of Registers      | 2 Bytes | 0x0001 |
|                           | Modbus CRC16               | 2 Bytes | 0xF114 |


Step3：Open BIO Gripper

|  |        **Open BIO Gripper**                               |         |                |
| -------------------- | ------------------------------------- | ------- | -------------- |
| **Request**          |                                       |         |                |
| Modbus RTU Data      | Slave ID (Gripper)                    | 1 Byte  | 0x08           |
|                      | Function Code                         | 1 Byte  | 0x10           |
|                      | Register Starting Address             | 2 Bytes | 0x0700         |
|                      | Quantity of Registers                 | 2 Bytes | 0x0002         |
|                      | Byte Count                            | 1 Byte  | 0x04           |
|                      | Registers Value(Open the BIO Gripper) | 4 Bytes | 0x0000, 0x0082 |
|                      | Modbus CRC16                          | 2 Bytes | 0x7B62         |
| **Response**         |                                       |         |                |
| Modbus RTU Data      | Slave ID                              | 1 Byte  | 0x08           |
|                      | Function Code                         | 1 Byte  | 0x10           |
|                      | Register Starting Address             | 2 Bytes | 0x0700         |
|                      | Quantity of Registers                 | 2 Bytes | 0x0002         |
|                      | Modbus CRC16                          | 2 Bytes | 0x4025         |

Read the Gripper status until it is in a stopped status.





|  |       **Get the BIO Gripper status**                                        |         |        |
| ------------------------------ | --------------------------------------------- | ------- | ------ |
| **Request**                    |                                               |         |        |
| Modbus RTU Data                | Slave ID (Gripper)                            | 1 Byte  | 0x08   |
|                                | Function Code                                 | 1 Byte  | 0x03   |
|                                | Register Starting Address                     | 2 Bytes | 0x0000 |
|                                | Quantity of Registers                         | 2 Bytes | 0x0001 |
|                                | Modbus CRC16                                  | 2 Bytes | 0x8493 |
| **Response**                   |                                               |         |        |
| Modbus RTU Data                | Slave ID                                      | 1 Byte  | 0x08   |
|                                | Function Code                                 | 1 Byte  | 0x03   |
|                                | Byte Count                                    | 1 Byte  | 0x02   |
|                                | Registers Value(Robotic arm is in stop statu) | 2 Bytes | 0x0000 |
|                                | Modbus CRC16                                  | 2 Bytes | 0x6445 |


Step4：Close BIO Gripper

|  |       **Close BIO Gripper**                                 |         |                |
| --------------------- | -------------------------------------- | ------- | -------------- |
| **Request**           |                                        |         |                |
| Modbus RTU Data       | Slave ID (Gripper)                     | 1 Byte  | 0x08           |
|                       | Function Code                          | 1 Byte  | 0x10           |
|                       | Register Starting Address              | 2 Bytes | 0x0700         |
|                       | Quantity of Registers                  | 2 Bytes | 0x0002         |
|                       | Byte Count                             | 1 Byte  | 0x04           |
|                       | Registers Value(Close the BIO Gripper) | 4 Bytes | 0x0000, 0x0032 |
|                       | Modbus CRC16                           | 2 Bytes | 0x7AD6         |
| **Response**          |                                        |         |                |
| Modbus RTU Data       | Slave ID                               | 1 Byte  | 0x08           |
|                       | Function Code                          | 1 Byte  | 0x10           |
|                       | Register Starting Address              | 2 Bytes | 0x0700         |
|                       | Quantity of Registers                  | 2 Bytes | 0x0002         |
|                       | Modbus CRC16                           | 2 Bytes | 0x4025         |

Read the Gripper status until it is in a stopped status

|  |        **Get the BIO Gripper status**                                       |         |        |
| ------------------------------ | --------------------------------------------- | ------- | ------ |
| **Request**                    |                                               |         |        |
| Modbus RTU Data                | Slave ID (Gripper)                            | 1 Byte  | 0x08   |
|                                | Function Code                                 | 1 Byte  | 0x03   |
|                                | Register Starting Address                     | 2 Bytes | 0x0000 |
|                                | Quantity of Registers                         | 2 Bytes | 0x0001 |
|                                | Modbus CRC16                                  | 2 Bytes | 0x8493 |
| **Response**                   |                                               |         |        |
| Modbus RTU Data                | Slave ID                                      | 1 Byte  | 0x08   |
|                                | Function Code                                 | 1 Byte  | 0x03   |
|                                | Byte Count                                    | 1 Byte  | 0x02   |
|                                | Registers Value(Robotic arm is in stop statu) | 2 Bytes | 0x0000 |
|                                | Modbus CRC16                                  | 2 Bytes | 0x6445 |
