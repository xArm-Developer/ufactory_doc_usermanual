# 3. BIO 机械爪的控制方式

### 3.1 用 xArm Studio 控制 BIO 机械爪

1. **设置 BIO 机械爪**

进入【设置】-【运动参数】-【TCP设置】

- **选择末端执行器：xArm BIO 机械爪**


![img_7.png](assets/img_5.png)

2. **控制 BIO 机械爪**

- 在实时控制界面控制 BIO 机械爪

![img_5.png](assets/img_6.png)


控制方法：

1. 点击【使能】按钮，使能 BIO 机械爪；
2. 通过点击【打开】/【关闭】按钮，来控制机械爪的开合。



- 通过 Blockly 编程来控制 BIO 机械爪,

进入在Blockly模块，运行UF_APPS目录下的[UF]-1009_Bio_Gripper示例

![img_8.png](assets/img_7.png)

这段程序的作用：执行此程序，可控制机械爪在指定位置夹取目标物，然后将目标物放到特定的位置。

**注意：**

1. 当机械爪安装到机械臂上时，在 Blockly 程序中应当设置 TCP 负载，当机械爪夹取物体后，其重量发生变化，则需要设置新的 TCP 负载。

### 3.2 用 Python-SDK 控制 BIO 机械爪

对于使用 Python-SDK 控制 BIO 机械爪的详细内容请见点击下面的链接查看:

[Python-SDK 示例](https://github.com/xArm-Developer/xArm-Python-SDK/blob/master/example/wrapper/common/5009-set_bio_gripper.py)

### 3.3 用 Modbus TCP 通信协议控制 BIO 机械爪

![img_9.png](assets/img_9.png)

本节主要阐述了如何通过调用 xArm 控制器的 Modbus-TCP 协议来控制 BIO 机械爪。

#### 3.3.1 Modbus TCP 通信协议

**Modbus-TCP：**  
Modbus 协议是一项应用层报文传输协议，有 ASCII、RTU、TCP 三种报文类型。标准 Modbus 协议物理层接口有 RS232、RS422、RS485 和以太网接口，采用 master/slave 方式通信。

**Modbus TCP 通信过程：**

1. 建立 TCP 连接
2. 准备 modbus 报文
3. 使用 send 命令发送报文
4. 在同一连接下等待应答
5. 使用 recv 命令读取报文，完成一次数据交换
6. 通信任务结束时，关闭 TCP 连接

**参数：**  
默认 TCP 端口：502  
协议标识：0x00 0x02  
控制（当前只有这一个）

**关于用户使用通信协议组织数据的大小端问题：**  
在本章节中，数据解析均为大端解析。



#### 3.3.2 读取 BIO 机械爪寄存器

##### 3.3.2.1 寄存器功能

|  |          **读取保持寄存器**      |                 |                      |
| ------------------ | -------------- |-----------------| -------------------- |
| **请求指令格式**   |                |                 |                      |
| Modbus TCP 包头    | 事务标识       | 2 Bytes         | 0x00，0x01           |
|                    | 协议标识       | 2 Bytes         | 0x00，0x02           |
|                    | 长度           | 2 Bytes         | 0x00，0x08           |
|                    | 寄存器         | 1 Byte          | 0x7C                 |
| 内部使用           | 主机 ID        | 1 Byte          | 0x09                 |
| Modbus RTU 数据    | 机械爪 ID      | 1 Byte          | 0x08                 |
|                    | 功能码         | 1 Byte          | 0x03                 |
|                    | 寄存器起始地址 | 2 Bytes         | **Address**          |
|                    | 寄存器数量     | 2 Bytes         | **N\***              |
| **响应指令格式**   |                |                 |                      |
| Modbus TCP 包头    | 事务标识       | 2 Bytes         | 0x00，0x01           |
|                    | 协议           | 2 Bytes         | 0x00，0x02           |
|                    | 长度           | 2 Bytes         | ***6+N\*x2** |
|                    | 寄存器         | 1 Byte          | 0x7C                 |
|                    | 状态           | 1 Byte          | 0x00                 |
| 内部使用           | 主机 ID        | 1 Byte          | 0x09                 |
| Modbus RTU 数据    | 机械爪 ID      | 1 Byte          | 0x08                 |
|                    | 功能码         | 1 Byte          | 0x03                 |
|                    | 字节数         | 1 Byte          | **N\*x2**            |
|                    | 寄存器值       | **N\*x2** Bytes | **Value**            |

**注：**  
N* = 寄存器数量  
Address = 寄存器起始地址（见下面列表）

**寄存器：**

|                | **寄存器起始地址** | **寄存器值** |                                                                                                                               |
| -------------- | ------------------ | ------------ |-------------------------------------------------------------------------------------------------------------------------------|
| 获取机械爪状态 | 0x0000             | 2 Bytes      | **未使能状态：**  0x0000 **使能中状态：**   0x0004   **使能完成状态** 0x0008  **停止状态**0x0008   **运动状态***0x0009 **夹取状态** 0x000A   **报错状态**0x000B |
| 获取机械爪错误 | 0x000F             | 2 Bytes      | **有错误**  其他返回值都代表有错误（除0以外）  **无错误**  0x0000                                                                                   |

##### 3.3.2.2 示例

1. **获取机械爪状态**

|  |               **获取机械爪状态**               |         |            |
| ------------------ | ---------------------------- | ------- | ---------- |
| **请求指令格式**   |                              |         |            |
| Modbus TCP 包头    | 事务标识                     | 2 Bytes | 0x00，0x01 |
|                    | 协议标识                     | 2 Bytes | 0x00，0x02 |
|                    | 长度                         | 2 Bytes | 0x00，0x08 |
|                    | 寄存器                       | 1 Byte  | 0x7C       |
| 内部使用           | 主机 ID                      | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID                    | 1 Byte  | 0x08       |
|                    | 功能码                       | 1 Byte  | 0x03       |
|                    | 寄存器起始地址               | 2 Bytes | 0x00，0x00 |
|                    | 寄存器数量                   | 2 Bytes | 0x00，0x01 |
| **响应指令格式**   |                              |         |            |
| Modbus TCP 包头    | 事务标识                     | 2 Bytes | 0x00，0x01 |
|                    | 协议                         | 2 Bytes | 0x00，0x02 |
|                    | 长度                         | 2 Bytes | 0x00，0x08 |
|                    | 寄存器                       | 1 Byte  | 0x7C       |
|                    | 状态                         | 1 Byte  | 0x00       |
| 内部使用           | 主机 ID                      | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID                    | 1 Byte  | 0x08       |
|                    | 功能码                       | 1 Byte  | 0x03       |
|                    | 字节数                       | 1 Byte  | 0x02       |
|                    | 寄存器值（机械爪在运动状态） | 2 Bytes | 0x00，0x09 |

2. **获取机械爪错误**

|  |   **读取保持寄存器**                     |         |            |
| ------------------ | ---------------------- | ------- | ---------- |
| **请求指令格式**   |                        |         |            |
| Modbus TCP 包头    | 事务标识               | 2 Bytes | 0x00，0x01 |
|                    | 协议                   | 2 Bytes | 0x00，0x02 |
|                    | 长度                   | 2 Bytes | 0x00，0x08 |
|                    | 寄存器                 | 1 Byte  | 0x7C       |
| 内部使用           | 主机 ID                | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID              | 1 Byte  | 0x08       |
|                    | 功能码                 | 1 Byte  | 0x03       |
|                    | 寄存器起始地址         | 2 Bytes | 0x00 0x0F  |
|                    | 寄存器数量             | 2 Bytes | 0x00 0x01  |
| **响应指令格式**   |                        |         |            |
| Modbus TCP 包头    | 事务标识               | 2 Bytes | 0x00，0x01 |
|                    | 协议                   | 2 Bytes | 0x00，0x02 |
|                    | 长度                   | 2 Bytes | 0x00，0x08 |
|                    | 寄存器                 | 1 Byte  | 0x7C       |
|                    | 状态                   | 1 Byte  | 0x00       |
| 内部使用           | 主机 ID                | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID              | 1 Byte  | 0x08       |
|                    | 功能码                 | 1 Byte  | 0x03       |
|                    | 字节数                 | 1 Byte  | 0x02       |
|                    | 寄存器值（无错误发生） | 2 Bytes | 0x00，0x00 |



#### 3.3.3 写入 BIO 机械爪寄存器

##### 3.3.3.1 寄存器功能

|   |          **写入寄存器**       |                 |                   |
| ---------------- | -------------- | --------------- | ----------------- |
| **请求指令格式** |                |                 |                   |
| Modbus TCP 包头  | 事务标识       | 2 Bytes         | 0x00，0x01         |
|                  | 协议           | 2 Bytes         | 0x00，0x02         |
|                  | 长度           | 2 Bytes         | **9+N\*x2** |
|                  | 寄存器         | 1 Byte          | 0x7C              |
| 内部使用         | 主机 ID        | 1 Byte          | 0x09              |
| Modbus RTU 数据  | 机械爪 ID      | 1 Byte          | 0x08              |
|                  | 功能码         | 1 Byte          | 0x10              |
|                  | 寄存器起始地址 | 2 Bytes         | **Address**       |
|                  | 寄存器数量     | 2 Bytes         | **N\***           |
|                  | 字节数         | 1 Byte          | **N\*x2**         |
|                  | 寄存器         | **N\***x2 Bytes | **Value**         |
| **响应指令格式** |                |                 |                   |
| Modbus TCP 包头  | 事务标识       | 2 Bytes         | 0x00，0x01         |
|                  | 协议           | 2 Bytes         | 0x00，0x02         |
|                  | 长度           | 2 Bytes         | 0x00，0x09         |
|                  | 寄存器         | 1 Byte          | 0x7C              |
|                  | 状态           | 1 Byte          | 0x00              |
| 内部使用         | 主机 ID        | 1 Byte          | 0x09              |
| Modbus RTU 数据  | 机械爪 ID      | 1 Byte          | 0x08              |
|                  | 功能码         | 1 Byte          | 0x10              |
|                  | 寄存器起始地址 | 2 Bytes         | **Address**       |
|                  | 寄存器数量     | 2 Bytes         | **N\***           |

注： N* = 寄存器数量	
    Address= 寄存器起始地址（见下面列表）	

**寄存器：**

|                 | **寄存器起始地址** | **寄存器值** |                                                              |
| --------------- | ------------------ | ------------ | ------------------------------------------------------------ |
| 使能/关闭机械爪 | 0x0100             | 2 Bytes      | **使能:** 0x0001  **停用:** 0x0000                           |
| 设置机械爪位置  | 0x0700             | 4 Bytes      | ***\*打开机械爪：\****0x0000 0x0082***\*闭合机械爪：\****0x0000 0x0032 |
| 设置机械爪速度  | 0x0303             | 2 Bytes      | 0x0000-0x0BB8                                                |
| 清除机械爪错误  | 0x000F             | 2 Bytes      | 0x0000                                                       |

#### 3.3.3.2 示例


1. **使能机械爪**

|   |     **使能机械爪**            |         |            |
| ---------------- | -------------- | ------- | ---------- |
| **请求指令格式** |                |         |            |
| Modbus TCP 包头  | 事务标识       | 2 Bytes | 0x00，0x01 |
|                  | 协议           | 2 Bytes | 0x00，0x02 |
|                  | 长度           | 2 Bytes | 0x00，0x0B |
|                  | 寄存器         | 1 Byte  | 0x7C       |
| 内部使用         | 主机 ID        | 1 Byte  | 0x09       |
| Modbus RTU 数据  | 机械爪 ID      | 1 Byte  | 0x08       |
|                  | 功能码         | 1 Byte  | 0x10       |
|                  | 寄存器起始地址 | 2 Bytes | 0x01，0x00 |
|                  | 寄存器数量     | 2 Bytes | 0x00，0x01 |
|                  | 字节数         | 1 Byte  | 0x02       |
|                  | 寄存器         | 2 Bytes | 0x00，0x01 |
| **响应指令格式** |                |         |            |
| Modbus TCP 包头  | 事务标识       | 2 Bytes | 0x00，0x01 |
|                  | 协议           | 2 Bytes | 0x00，0x02 |
|                  | 长度           | 2 Bytes | 0x00，0x09 |
|                  | 寄存器         | 1 Byte  | 0x7C       |
|                  | 状态           | 1 Byte  | 0x00       |
| 内部使用         | 主机 ID        | 1 Byte  | 0x09       |
| Modbus RTU 数据  | 机械爪 ID      | 1 Byte  | 0x08       |
|                  | 功能码         | 1 Byte  | 0x10       |
|                  | 寄存器起始地址 | 2 Bytes | 0x01，0x00 |
|                  | 寄存器数量     | 2 Bytes | 0x00，0x01 |

2. **设置机械爪速度**

|  |     **设置机械爪速度**                     |         |            |
| ------------------ | ------------------------ | ------- | ---------- |
| **请求指令格式**   |                          |         |            |
| Modbus TCP 包头    | 事务标识                 | 2 Bytes | 0x00，0x01 |
|                    | 协议                     | 2 Bytes | 0x00，0x02 |
|                    | 长度                     | 2 Bytes | 0x00，0x0B |
|                    | 寄存器                   | 1 Byte  | 0x7C       |
| 内部使用           | 主机 ID                  | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID                | 1 Byte  | 0x08       |
|                    | 功能码                   | 1 Byte  | 0x10       |
|                    | 寄存器起始地址           | 2 Bytes | 0x03，0x03 |
|                    | 寄存器数量               | 2 Bytes | 0x00，0x01 |
|                    | 字节数                   | 1 Byte  | 0x02       |
|                    | 寄存器（设置速度为1500） | 2 Bytes | 0x05，0xDC |
| **响应指令格式**   |                          |         |            |
| Modbus TCP 包头    | 事务标识                 | 2 Bytes | 0x00，0x01 |
|                    | 协议                     | 2 Bytes | 0x00，0x02 |
|                    | 长度                     | 2 Bytes | 0x00，0x09 |
|                    | 寄存器                   | 1 Byte  | 0x7C       |
|                    | 状态                     | 1 Byte  | 0x00       |
| 内部使用           | 主机 ID                  | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID                | 1 Byte  | 0x08       |
|                    | 功能码                   | 1 Byte  | 0x10       |
|                    | 寄存器起始地址           | 2 Bytes | 0x03，0x03 |
|                    | 寄存器数量               | 2 Bytes | 0x00，0x01 |




3. **设置机械爪位置**

|  |        **设置机械爪位置**              |         |                         |
| ------------------ | -------------------- | ------- | ----------------------- |
| **请求指令格式**   |                      |         |                         |
| Modbus TCP 包头    | 事务标识             | 2 Bytes | 0x00，0x01              |
|                    | 协议                 | 2 Bytes | 0x00，0x02              |
|                    | 长度                 | 2 Bytes | 0x00，0x0D              |
|                    | 寄存器               | 1 Byte  | 0x7C                    |
| 内部使用           | 主机 ID              | 1 Byte  | 0x09                    |
| Modbus RTU 数据    | 机械爪 ID            | 1 Byte  | 0x08                    |
|                    | 功能码               | 1 Byte  | 0x10                    |
|                    | 寄存器起始地址       | 2 Bytes | 0x07，0x00              |
|                    | 寄存器数量           | 2 Bytes | 0x00，0x02              |
|                    | 字节数               | 1 Byte  | 0x04                    |
|                    | 寄存器（打开机械爪） | 4 Bytes | 0x00，0x00，0x00，0x130 |
| **响应指令格式**   |                      |         |                         |
| Modbus TCP 包头    | 事务标识             | 2 Bytes | 0x00，0x01              |
|                    | 协议                 | 2 Bytes | 0x00，0x02              |
|                    | 长度                 | 2 Bytes | 0x00，0x09              |
|                    | 寄存器               | 1 Byte  | 0x7C                    |
|                    | 状态                 | 1 Byte  | 0x00                    |
| 内部使用           | 主机 ID              | 1 Byte  | 0x09                    |
| Modbus RTU 数据    | 机械爪 ID            | 1 Byte  | 0x08                    |
|                    | 功能码               | 1 Byte  | 0x10                    |
|                    | 寄存器起始地址       | 2 Bytes | 0x07，0x00              |
|                    | 寄存器数量           | 2 Bytes | 0x00，0x02              |

4. **清除机械爪错误**

|  |    **清除机械爪错误**            |         |            |
| ------------------ | -------------- | ------- | ---------- |
| **请求指令格式**   |                |         |            |
| Modbus TCP 包头    | 事务标识       | 2 Bytes | 0x00，0x01 |
|                    | 协议           | 2 Bytes | 0x00，0x02 |
|                    | 长度           | 2 Bytes | 0x00，0x0B |
|                    | 寄存器         | 1 Byte  | 0x7C       |
| 内部使用           | 主机 ID        | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID      | 1 Byte  | 0x08       |
|                    | 功能码         | 1 Byte  | 0x10       |
|                    | 寄存器起始地址 | 2 Bytes | 0x00 0x0F  |
|                    | 寄存器数量     | 2 Bytes | 0x00 0x01  |
|                    | 字节数         | 1 Byte  | 0x02       |
|                    | 寄存器         | 2 Bytes | 0x00 0x01  |
| **响应指令格式**   |                |         |            |
| Modbus TCP 包头    | 事务标识       | 2 Bytes | 0x00，0x01 |
|                    | 协议           | 2 Bytes | 0x00，0x02 |
|                    | 长度           | 2 Bytes | 0x00，0x09 |
|                    | 寄存器         | 1 Byte  | 0x7C       |
|                    | 状态           | 1 Byte  | 0x00       |
| 内部使用           | 主机 ID        | 1 Byte  | 0x09       |
| Modbus RTU 数据    | 机械爪 ID      | 1 Byte  | 0x08       |
|                    | 功能码         | 1 Byte  | 0x10       |
|                    | 寄存器起始地址 | 2 Bytes | 0x00 0x0F  |
|                    | 寄存器数量     | 2 Bytes | 0x00 0x01  |

